FROM python:3.9-slim

RUN apt-get update && apt-get install -y \
    postgresql-client \
    jq \
    wait-for-it \
    moreutils \
    && rm -rf /var/lib/apt/lists/*

RUN pip install pgsync

WORKDIR /app

COPY pgsync/entrypoint.sh /app/
COPY pgsync/schema.json /app/
COPY pgsync/conf.sql /app/
COPY pgsync/populate.sql /app/

RUN sed -i 's/\r$//' /app/entrypoint.sh && \
    chmod +x /app/entrypoint.sh

ENTRYPOINT ["/bin/bash", "/app/entrypoint.sh"]


